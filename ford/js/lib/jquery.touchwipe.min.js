(function ($) {
    $.fn.touchwipe = function (settings) {
        var config = {
            min_move_x: 50,
            min_move_y: 50,
            wipeLeft: function () {},
            wipeRight: function () {},
            wipeUp: function () {},
            wipeDown: function () {},
            preventDefaultEvents: true
        };
        if (settings) $.extend(config, settings);
        this.each(function () {
            var startX;
            var startY;
            var isMoving = false;
            var gesture;
            var ev = ('ontouchstart' in document) ? 'touchmove' : (navigator.msMaxTouchPoints > 1) ? 'MSGestureChange' : 'mouseup';
            var mstouch = (navigator.msMaxTouchPoints > 1);

            function cancelTouch() {
                this.removeEventListener(ev, onTouchMove);
                startX = null;
                startY = null;
                isMoving = false
            }

            function onTouchMove(e) {
                if (config.preventDefaultEvents) {
                    e.preventDefault()
                }
                if (isMoving) {
                    var x = (e.touches) ? e.touches[0].pageX : e.screenX;
                    var y = (e.touches) ? e.touches[0].pageY : e.screenY;
                    var dx = startX - x;
                    var dy = startY - y;
                    if (Math.abs(dx) >= config.min_move_x) {
                        cancelTouch();
                        if (dx > 0) {
                            config.wipeLeft()
                        } else {
                            config.wipeRight()
                        }
                    }
                    if (Math.abs(dy) >= config.min_move_y) {
                        cancelTouch();
                        if (dy > 0) {
                            config.wipeUp()
                        } else {
                            config.wipeDown()
                        }
                    }
                }
            }

            function onTouchStart(e) {
                if ((e.touches && e.touches.length == 1) || (navigator.msMaxTouchPoints > 1)) {
                    if (e.type == "pointerdown") {
                        gesture.addPointer(e.pointerId);
                        return
                    }
                    startX = (e.touches) ? e.touches[0].pageX : e.screenX;
                    startY = (e.touches) ? e.touches[0].pageY : e.screenY;
                    isMoving = true;
                    this.addEventListener(ev, onTouchMove, false)
                }
            }
            var ts = ('ontouchstart' in document) ? 'touchstart' : ((navigator.msMaxTouchPoints > 1) ? 'MSGestureStart' : 'mousedown');
            if (mstouch) {
                gesture = new MSGesture();
                gesture.target = this;
                this.addEventListener("pointerdown", onTouchStart, false)
            }
            this.addEventListener(ts, onTouchStart, false)
        });
        return this
    }
})(jQuery);